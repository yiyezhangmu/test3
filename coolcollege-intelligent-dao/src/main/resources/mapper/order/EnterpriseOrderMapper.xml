<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.coolcollege.intelligent.dao.order.EnterpriseOrderMapper">

    <resultMap type="com.coolcollege.intelligent.model.order.EnterpriseOrderDO"
               id="EnterpriseOrderDOResult">
        <result property="id" column="id"/>
        <result property="enterpriseId" column="enterprise_id"/>
        <result property="goodsCode" column="goods_code"/>
        <result property="itemCode" column="item_code"/>
        <result property="totalActualPayFee" column="total_actual_pay_fee"/>
        <result property="payTime" column="pay_time"/>
        <result property="buyCorpId" column="buy_corp_id"/>
        <result property="quantity" column="quantity"/>
        <result property="status" column="status"/>
        <result property="bizOrderId" column="biz_order_id"/>
        <result property="orderSource" column="order_source"/>
        <result property="appId" column="app_id"/>
        <result property="type" column="type"/>
        <result property="operatorId" column="operator_id"/>
        <result property="editionId" column="edition_id"/>
        <result property="editionName" column="edition_name"/>
        <result property="userCount" column="user_count"/>
        <result property="orderPeriod" column="order_period"/>
        <result property="orderTime" column="order_time"/>
        <result property="beginTime" column="begin_time"/>
        <result property="endTime" column="end_time"/>
        <result property="orderFrom" column="order_from"/>
        <result property="operatorCorpid" column="operator_corpid"/>
        <result property="serviceShareAmount" column="service_share_amount"/>
        <result property="platformShareAmount" column="platform_share_amount"/>
        <result property="dealerShareAmount" column="dealer_share_amount"/>
        <result property="dealerCorpInfo" column="dealer_corp_info"/>
        <result property="dealerCorpId" column="dealer_corp_id"/>
        <result property="dealerCorpName" column="dealer_corp_name"/>
        <result property="refundTime" column="refund_time"/>
    </resultMap>

    <insert id="batchInsertEnterpriseOrder">
        insert into enterprise_order (
        enterprise_id,
        goods_code,
        item_code,
        total_actual_pay_fee,
        pay_time,
        buy_corp_id,
        quantity,
        status,
        biz_order_id,
        order_source,
        type,
        app_id,
        operator_id,
        edition_id,
        edition_name,
        user_count,
        order_period,
        order_time,
        begin_time,
        end_time,
        order_from,
        operator_corpid,
        service_share_amount,
        platform_share_amount,
        dealer_share_amount,
        dealer_corp_info,
        dealer_corp_id,
        dealer_corp_name
        )values
        <foreach collection="list" item="enterpriseOrder" separator=",">
        (
            #{enterpriseOrder.enterpriseId},
            #{enterpriseOrder.goodsCode},
            #{enterpriseOrder.itemCode},
            #{enterpriseOrder.totalActualPayFee},
            #{enterpriseOrder.payTime},
            #{enterpriseOrder.buyCorpId},
            #{enterpriseOrder.quantity},
            #{enterpriseOrder.status},
            #{enterpriseOrder.bizOrderId},
            #{enterpriseOrder.orderSource},
            #{enterpriseOrder.type},
            #{enterpriseOrder.appId},
            #{enterpriseOrder.operatorId},
            #{enterpriseOrder.editionId},
            #{enterpriseOrder.editionName},
            #{enterpriseOrder.userCount},
            #{enterpriseOrder.orderPeriod},
            #{enterpriseOrder.orderTime},
            #{enterpriseOrder.beginTime},
            #{enterpriseOrder.endTime},
            #{enterpriseOrder.orderFrom},
            #{enterpriseOrder.operatorCorpid},
            #{enterpriseOrder.serviceShareAmount},
            #{enterpriseOrder.platformShareAmount},
            #{enterpriseOrder.dealerShareAmount},
            #{enterpriseOrder.dealerCorpInfo},
            #{enterpriseOrder.dealerCorpId},
            #{enterpriseOrder.dealerCorpName}
            )
        </foreach>
    </insert>

    <select id="getByBizOrderId" resultMap="EnterpriseOrderDOResult">
        select * from enterprise_order
        where biz_order_id = #{bizOrderId}
    </select>

    <update id="updateOrderStatus">
        update enterprise_order
        set status = #{status}, enterprise_id = #{enterpriseId}
        <if test="refundTime != null">
            ,refund_time = #{refundTime}
        </if>
        where biz_order_id = #{bizOrderId}
    </update>

    <update id="updatePayOrderInfo">
        update enterprise_order
        set status = #{status}, enterprise_id = #{enterpriseId}
        <if test="payTime != null">
            ,pay_time = #{payTime}
        </if>
        <if test="totalActualPayFee != null">
            ,total_actual_pay_fee = #{totalActualPayFee}
        </if>
        <if test="beginTime != null">
            ,begin_time = #{beginTime}
        </if>
        <if test="endTime != null">
            ,end_time = #{endTime}
        </if>
        where biz_order_id = #{bizOrderId}
    </update>

    <update id="updateOrderInfo">
        update enterprise_order
        set status = #{orderInfo.orderStatus}
        <if test="orderInfo.editionId != null and orderInfo.editionId != ''">
            ,edition_id = #{orderInfo.editionId}
        </if>
        <if test="orderInfo.editionName != null and orderInfo.editionName != ''">
            ,edition_name = #{orderInfo.editionName}
        </if>
        <if test="orderInfo.userCount != null">
            ,user_count = #{orderInfo.userCount}
        </if>
        <if test="orderInfo.orderPeriod != null">
            ,order_period = #{orderInfo.orderPeriod}
        </if>
        <if test="orderInfo.price != null">
            ,total_actual_pay_fee = #{orderInfo.price}
        </if>
        <if test="orderInfo.serviceShareAmount != null">
            ,service_share_amount = #{orderInfo.serviceShareAmount}
        </if>
        <if test="orderInfo.platformShareAmount != null">
            ,platform_share_amount = #{orderInfo.platformShareAmount}
        </if>
        <if test="orderInfo.dealerShareAmount != null">
            ,dealer_share_amount = #{orderInfo.dealerShareAmount}
        </if>
        <if test="orderInfo.beginTime != null">
            ,begin_time = #{orderInfo.beginTime}
        </if>
        <if test="orderInfo.endTime != null">
            ,end_time = #{orderInfo.endTime}
        </if>
        where biz_order_id = #{orderInfo.orderid}
    </update>
</mapper>