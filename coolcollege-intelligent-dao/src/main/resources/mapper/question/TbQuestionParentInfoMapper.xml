<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coolcollege.intelligent.dao.question.TbQuestionParentInfoMapper">
  <resultMap id="BaseResultMap" type="com.coolcollege.intelligent.model.question.TbQuestionParentInfoDO">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="unify_task_id" jdbcType="BIGINT" property="unifyTaskId" />
    <result column="question_name" jdbcType="VARCHAR" property="questionName" />
    <result column="question_type" jdbcType="VARCHAR" property="questionType" />
    <result column="finish_num" jdbcType="INTEGER" property="finishNum" />
    <result column="total_num" jdbcType="INTEGER" property="totalNum" />
    <result column="create_id" jdbcType="VARCHAR" property="createId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_id" jdbcType="VARCHAR" property="updateId" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>
  <sql id="Base_Column_List">
    id, unify_task_id, question_name, question_type, finish_num, total_num,status , create_id,
    create_time, update_id, update_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from tb_question_parent_info_${enterpriseId}
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectByUnifyTaskId" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from tb_question_parent_info_${enterpriseId}
    where unify_task_id = #{unifyTaskId}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from tb_question_parent_info_${enterpriseId}
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insertSelective" keyColumn="id" keyProperty="record.id" useGeneratedKeys="true">
    insert into tb_question_parent_info_${enterpriseId}
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="record.unifyTaskId != null">
        unify_task_id,
      </if>
      <if test="record.questionName != null">
        question_name,
      </if>
      <if test="record.questionType != null">
        question_type,
      </if>
      <if test="record.finishNum != null">
        finish_num,
      </if>
      <if test="record.totalNum != null">
        total_num,
      </if>
      <if test="record.status != null">
        status,
      </if>
      <if test="record.createId != null">
        create_id,
      </if>
      <if test="record.createTime != null">
        create_time,
      </if>
      <if test="record.updateId != null">
        update_id,
      </if>
      <if test="record.updateTime != null">
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="record.unifyTaskId != null">
        #{record.unifyTaskId,jdbcType=BIGINT},
      </if>
      <if test="record.questionName != null">
        #{record.questionName,jdbcType=VARCHAR},
      </if>
      <if test="record.questionType != null">
        #{record.questionType,jdbcType=VARCHAR},
      </if>
      <if test="record.finishNum != null">
        #{record.finishNum,jdbcType=INTEGER},
      </if>
      <if test="record.totalNum != null">
        #{record.totalNum,jdbcType=INTEGER},
      </if>
      <if test="record.status != null">
        #{record.status,jdbcType=INTEGER},
      </if>
      <if test="record.createId != null">
        #{record.createId,jdbcType=VARCHAR},
      </if>
      <if test="record.createTime != null">
        #{record.createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.updateId != null">
        #{record.updateId,jdbcType=VARCHAR},
      </if>
      <if test="record.updateTime != null">
        #{record.updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
    <update id="addFinishNum">
      update tb_question_parent_info_${enterpriseId} set finish_num = finish_num + 1 where id = #{id}
    </update>
    <update id="updateByPrimaryKeySelective" parameterType="com.coolcollege.intelligent.model.question.TbQuestionParentInfoDO">
    update tb_question_parent_info_${enterpriseId}
    <set>
      <if test="record.unifyTaskId != null">
        unify_task_id = #{record.unifyTaskId,jdbcType=BIGINT},
      </if>
      <if test="record.questionName != null">
        question_name = #{record.questionName,jdbcType=VARCHAR},
      </if>
      <if test="record.questionType != null">
        question_type = #{record.questionType,jdbcType=VARCHAR},
      </if>
      <if test="record.finishNum != null">
        finish_num = #{record.finishNum,jdbcType=INTEGER},
      </if>
      <if test="record.totalNum != null">
        total_num = #{record.totalNum,jdbcType=INTEGER},
      </if>
      <if test="record.status != null">
        status =  #{record.status,jdbcType=INTEGER},
      </if>
      <if test="record.createId != null">
        create_id = #{record.createId,jdbcType=VARCHAR},
      </if>
      <if test="record.createTime != null">
        create_time = #{record.createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.updateId != null">
        update_id = #{record.updateId,jdbcType=VARCHAR},
      </if>
      <if test="record.updateTime != null">
        update_time = #{record.updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{record.id,jdbcType=BIGINT}
  </update>
  <sql id="dynamicQuery">
    <trim prefix="WHERE" prefixOverrides="AND | OR">
      <if test="null != id">
        and t.id = #{id,jdbcType=BIGINT}
      </if>
      <if test="null != unifyTaskId">
        and t.unify_task_id = #{unifyTaskId,jdbcType=BIGINT}
      </if>
      <if test="null != questionName">
        and t.question_name = #{questionName,jdbcType=VARCHAR}
      </if>
      <if test="null != questionType">
        and t.question_type = #{questionType,jdbcType=VARCHAR}
      </if>
      <if test="null != finishNum">
        and t.finish_num = #{finishNum,jdbcType=INTEGER}
      </if>
      <if test="null != totalNum">
        and t.total_num = #{totalNum,jdbcType=INTEGER}
      </if>
      <if test="null != createId">
        and t.create_id = #{createId,jdbcType=VARCHAR}
      </if>
      <if test="null != createTime">
        and t.create_time = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="null != updateId">
        and t.update_id = #{updateId,jdbcType=VARCHAR}
      </if>
      <if test="null != updateTime">
        and t.update_time = #{updateTime,jdbcType=TIMESTAMP}
      </if>
      <if test="status != null">
        and status =  #{status,jdbcType=INTEGER}
      </if>
    </trim>
  </sql>

  <select id="list" resultType="com.coolcollege.intelligent.model.question.TbQuestionParentInfoDO">
    select
    <include refid="Base_Column_List"/>
    from tb_question_parent_info_${enterpriseId}
    <where>
      <if test="params.questionType != null and params.questionType != ''">
        and question_type = #{params.questionType}
      </if>
      <if test="params.status != null">
        and status = #{params.status}
      </if>
      <if test="params.createUserIdList != null and params.createUserIdList.size > 0">
        and create_id in
        <foreach collection="params.createUserIdList" item="createUserId" open="(" separator="," close=")">
          #{createUserId}
        </foreach>
      </if>
      <if test="params.questionName != null and params.questionName != ''">
        and question_name like concat('%',#{params.questionName},'%')
      </if>
      <if test="params.beginCreateDate != null and params.endCreateDate != null and params.beginCreateDate != '' and params.endCreateDate != ''">
        and create_time between #{params.beginCreateDate} and #{params.endCreateDate}
      </if>
    </where>
     order by create_time desc
  </select>
    <select id="selectByIdList" resultType="com.coolcollege.intelligent.model.question.TbQuestionParentInfoDO">
      select
      <include refid="Base_Column_List" />
      from tb_question_parent_info_${enterpriseId}
      where id in
      <foreach collection="idList" item="id" open="(" separator="," close=")">
        #{id}
      </foreach>
      order by create_time desc
    </select>


  <select id="questionListCount" resultType="java.lang.Long">
    select
    count(1) as count
    from tb_question_parent_info_${enterpriseId}
    <where>
      <if test="params.questionType != null and params.questionType != ''">
        and question_type = #{params.questionType}
      </if>
      <if test="params.status != null">
        and status = #{params.status}
      </if>
      <if test="params.createUserIdList != null and params.createUserIdList.size > 0">
        and create_id in
        <foreach collection="params.createUserIdList" item="createUserId" open="(" separator="," close=")">
          #{createUserId}
        </foreach>
      </if>
      <if test="params.questionName != null and params.questionName != ''">
        and question_name like concat('%',#{params.questionName},'%')
      </if>
      <if test="params.beginCreateDate != null and params.endCreateDate != null and params.beginCreateDate != '' and params.endCreateDate != ''">
        and create_time between #{params.beginCreateDate} and #{params.endCreateDate}
      </if>
    </where>
    order by create_time desc
  </select>


  <select id="selectByUnifyTaskIds"  resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from tb_question_parent_info_${enterpriseId}
    where unify_task_id in
    <foreach collection="unifyTaskIds" item="unifyTaskId" open="(" separator="," close=")">
      #{unifyTaskId}
    </foreach>
  </select>


  <select id="selectCount" resultType="java.lang.Long">
    select
    count(1)
    from
    tb_question_parent_info_${enterpriseId} a
    right join tb_question_parent_user_mapping_${enterpriseId} b
    on a.id = b.question_parent_id
    where b.handle_user_id = #{userId}
    <choose>
      <when test="questionExpireHandle != null and questionExpireHandle == false and questionExpireApprove != null and questionExpireApprove == false">
        and (b.is_handle_user = #{isHandleUser} or b.is_approve_user  = #{isHandleUser}) and b.end_time > now()
      </when>
      <when test="questionExpireHandle != null and questionExpireHandle == true and questionExpireApprove != null and questionExpireApprove == false">
        and ((b.is_approve_user =  #{isHandleUser} and b.end_time > now()) or b.is_handle_user  = #{isHandleUser})
      </when>
      <when test="questionExpireHandle != null and questionExpireHandle == false and questionExpireApprove != null and questionExpireApprove == true">
        and ((b.is_handle_user =  #{isHandleUser} and b.end_time > now()) or b.is_approve_user  = #{isHandleUser})
      </when>
      <otherwise>
        and (b.is_handle_user = #{isHandleUser} or b.is_approve_user  = #{isHandleUser})
      </otherwise>
    </choose>
    and b.status = #{status}
  </select>
</mapper>