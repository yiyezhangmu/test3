<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coolcollege.intelligent.dao.fsGroup.FsGroupNoticeMapper">

    <resultMap type="com.coolcollege.intelligent.model.fsGroup.FsGroupNoticeDO" id="FsGroupNoticeMap">
        <result property="id" column="id" jdbcType="INTEGER"/>
        <result property="name" column="name" jdbcType="VARCHAR"/>
        <result property="img" column="img" jdbcType="VARCHAR"/>
        <result property="imgUrl" column="img_url" jdbcType="VARCHAR"/>
        <result property="content" column="content" jdbcType="VARCHAR"/>
        <result property="detail" column="detail" jdbcType="VARCHAR"/>
        <result property="detailType" column="detail_type" jdbcType="VARCHAR"/>
        <result property="detailUrl" column="detail_url" jdbcType="VARCHAR"/>
        <result property="sendStoreRegionIds" column="send_store_region_ids" jdbcType="VARCHAR"/>
        <result property="sendRegionChatIds" column="send_region_chat_ids" jdbcType="VARCHAR"/>
        <result property="sendOtherChatIds" column="send_other_chat_ids" jdbcType="VARCHAR"/>
        <result property="sendTimeType" column="send_time_type" jdbcType="VARCHAR"/>
        <result property="sendUserCount" column="send_user_count" jdbcType="INTEGER"/>
        <result property="hasReadCount" column="has_read_count" jdbcType="INTEGER"/>
        <result property="hasSend" column="has_send" jdbcType="VARCHAR"/>
        <result property="sendTime" column="send_time" jdbcType="TIMESTAMP"/>
        <result property="createUserId" column="create_user_id" jdbcType="VARCHAR"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
        <result property="updateUser" column="update_user" jdbcType="VARCHAR"/>
    </resultMap>
    
    <sql id="baseSql">
        id as id,name as name,img as img,img_url as imgUrl,content as content,detail as detail,detail_type as detailType,detail_url as detailUrl,send_store_region_ids as sendStoreRegionIds,send_region_chat_ids as sendRegionChatIds,send_other_chat_ids as sendOtherChatIds,send_time_type as sendTimeType,send_user_count as sendUserCount,has_read_count as hasReadCount,has_send as hasSend,send_time as sendTime,create_user_id as createUserId,create_time as createTime,update_time as updateTime,update_user as updateUser    </sql>

    <!--查询单个-->
    <select id="queryById" resultType="com.coolcollege.intelligent.model.fsGroup.FsGroupNoticeDO">
        select
          <include refid="baseSql"></include>
        from fs_group_notice_${eid}
        where id = #{id}
    </select>

    <!--统计总行数-->
    <select id="count" resultType="java.lang.Long">
        select count(1)
        from fs_group_notice_${eid}
        <where>
            <if test="fsGroupNoticeDO.id != null">
                and id = #{fsGroupNoticeDO.id}
            </if>
            <if test="fsGroupNoticeDO.name != null and fsGroupNoticeDO.name != ''">
                and name = #{fsGroupNoticeDO.name}
            </if>
            <if test="fsGroupNoticeDO.img != null and fsGroupNoticeDO.img != ''">
                and img = #{fsGroupNoticeDO.img}
            </if>
            <if test="fsGroupNoticeDO.imgUrl != null and fsGroupNoticeDO.imgUrl != ''">
                and img_url = #{fsGroupNoticeDO.imgUrl}
            </if>
            <if test="fsGroupNoticeDO.content != null and fsGroupNoticeDO.content != ''">
                and content = #{fsGroupNoticeDO.content}
            </if>
            <if test="fsGroupNoticeDO.detail != null and fsGroupNoticeDO.detail != ''">
                and detail = #{fsGroupNoticeDO.detail}
            </if>
            <if test="fsGroupNoticeDO.detailType != null and fsGroupNoticeDO.detailType != ''">
                and detail_type = #{fsGroupNoticeDO.detailType}
            </if>
            <if test="fsGroupNoticeDO.detailUrl != null and fsGroupNoticeDO.detailUrl != ''">
                and detail_url = #{fsGroupNoticeDO.detailUrl}
            </if>
            <if test="fsGroupNoticeDO.sendStoreRegionIds != null and fsGroupNoticeDO.sendStoreRegionIds != ''">
                and send_store_region_ids = #{fsGroupNoticeDO.sendStoreRegionIds}
            </if>
            <if test="fsGroupNoticeDO.sendRegionChatIds != null and fsGroupNoticeDO.sendRegionChatIds != ''">
                and send_region_chat_ids = #{fsGroupNoticeDO.sendRegionChatIds}
            </if>
            <if test="fsGroupNoticeDO.sendOtherChatIds != null and fsGroupNoticeDO.sendOtherChatIds != ''">
                and send_other_chat_ids = #{fsGroupNoticeDO.sendOtherChatIds}
            </if>
            <if test="fsGroupNoticeDO.sendTimeType != null and fsGroupNoticeDO.sendTimeType != ''">
                and send_time_type = #{fsGroupNoticeDO.sendTimeType}
            </if>
            <if test="fsGroupNoticeDO.sendUserCount != null">
                and send_user_count = #{fsGroupNoticeDO.sendUserCount}
            </if>
            <if test="fsGroupNoticeDO.hasReadCount != null">
                and has_read_count = #{fsGroupNoticeDO.hasReadCount}
            </if>
            <if test="fsGroupNoticeDO.hasSend != null and fsGroupNoticeDO.hasSend != ''">
                and has_send = #{fsGroupNoticeDO.hasSend}
            </if>
            <if test="fsGroupNoticeDO.sendTime != null">
                and send_time = #{fsGroupNoticeDO.sendTime}
            </if>
            <if test="fsGroupNoticeDO.createUserId != null and fsGroupNoticeDO.createUserId != ''">
                and create_user_id = #{fsGroupNoticeDO.createUserId}
            </if>
            <if test="fsGroupNoticeDO.createTime != null">
                and create_time = #{fsGroupNoticeDO.createTime}
            </if>
            <if test="fsGroupNoticeDO.updateTime != null">
                and update_time = #{fsGroupNoticeDO.updateTime}
            </if>
            <if test="fsGroupNoticeDO.updateUser != null and fsGroupNoticeDO.updateUser != ''">
                and update_user = #{fsGroupNoticeDO.updateUser}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="fsGroupNoticeDO.id" useGeneratedKeys="true">
        insert into fs_group_notice_${eid}
    <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="fsGroupNoticeDO.name != null and fsGroupNoticeDO.name != ''">
                name,
            </if>
            <if test="fsGroupNoticeDO.img != null and fsGroupNoticeDO.img != ''">
                img,
            </if>
            <if test="fsGroupNoticeDO.imgUrl != null and fsGroupNoticeDO.imgUrl != ''">
                img_url,
            </if>
            <if test="fsGroupNoticeDO.content != null and fsGroupNoticeDO.content != ''">
                content,
            </if>
            <if test="fsGroupNoticeDO.detail != null and fsGroupNoticeDO.detail != ''">
                detail,
            </if>
            <if test="fsGroupNoticeDO.detailType != null and fsGroupNoticeDO.detailType != ''">
                detail_type,
            </if>
            <if test="fsGroupNoticeDO.detailUrl != null and fsGroupNoticeDO.detailUrl != ''">
                detail_url,
            </if>
            <if test="fsGroupNoticeDO.sendStoreRegionIds != null and fsGroupNoticeDO.sendStoreRegionIds != ''">
                send_store_region_ids,
            </if>
            <if test="fsGroupNoticeDO.sendRegionChatIds != null and fsGroupNoticeDO.sendRegionChatIds != ''">
                send_region_chat_ids,
            </if>
            <if test="fsGroupNoticeDO.sendOtherChatIds != null and fsGroupNoticeDO.sendOtherChatIds != ''">
                send_other_chat_ids,
            </if>
            <if test="fsGroupNoticeDO.sendTimeType != null and fsGroupNoticeDO.sendTimeType != ''">
                send_time_type,
            </if>
            <if test="fsGroupNoticeDO.sendUserCount != null">
                send_user_count,
            </if>
            <if test="fsGroupNoticeDO.hasReadCount != null">
                has_read_count,
            </if>
            <if test="fsGroupNoticeDO.hasSend != null and fsGroupNoticeDO.hasSend != ''">
                has_send,
            </if>
            <if test="fsGroupNoticeDO.sendTime != null">
                send_time,
            </if>
            <if test="fsGroupNoticeDO.createUserId != null and fsGroupNoticeDO.createUserId != ''">
                create_user_id,
            </if>
            <if test="fsGroupNoticeDO.createTime != null">
                create_time,
            </if>
            <if test="fsGroupNoticeDO.updateTime != null">
                update_time,
            </if>
            <if test="fsGroupNoticeDO.updateUser != null and fsGroupNoticeDO.updateUser != ''">
                update_user,
            </if>
     </trim>
        values 
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="fsGroupNoticeDO.name != null and fsGroupNoticeDO.name != ''">
                #{fsGroupNoticeDO.name},
            </if>
            <if test="fsGroupNoticeDO.img != null and fsGroupNoticeDO.img != ''">
                #{fsGroupNoticeDO.img},
            </if>
            <if test="fsGroupNoticeDO.imgUrl != null and fsGroupNoticeDO.imgUrl != ''">
                #{fsGroupNoticeDO.imgUrl},
            </if>
            <if test="fsGroupNoticeDO.content != null and fsGroupNoticeDO.content != ''">
                #{fsGroupNoticeDO.content},
            </if>
            <if test="fsGroupNoticeDO.detail != null and fsGroupNoticeDO.detail != ''">
                #{fsGroupNoticeDO.detail},
            </if>
            <if test="fsGroupNoticeDO.detailType != null and fsGroupNoticeDO.detailType != ''">
                #{fsGroupNoticeDO.detailType},
            </if>
            <if test="fsGroupNoticeDO.detailUrl != null and fsGroupNoticeDO.detailUrl != ''">
                #{fsGroupNoticeDO.detailUrl},
            </if>
            <if test="fsGroupNoticeDO.sendStoreRegionIds != null and fsGroupNoticeDO.sendStoreRegionIds != ''">
                #{fsGroupNoticeDO.sendStoreRegionIds},
            </if>
            <if test="fsGroupNoticeDO.sendRegionChatIds != null and fsGroupNoticeDO.sendRegionChatIds != ''">
                #{fsGroupNoticeDO.sendRegionChatIds},
            </if>
            <if test="fsGroupNoticeDO.sendOtherChatIds != null and fsGroupNoticeDO.sendOtherChatIds != ''">
                #{fsGroupNoticeDO.sendOtherChatIds},
            </if>
            <if test="fsGroupNoticeDO.sendTimeType != null and fsGroupNoticeDO.sendTimeType != ''">
                #{fsGroupNoticeDO.sendTimeType},
            </if>
            <if test="fsGroupNoticeDO.sendUserCount != null">
                #{fsGroupNoticeDO.sendUserCount},
            </if>
            <if test="fsGroupNoticeDO.hasReadCount != null">
                #{fsGroupNoticeDO.hasReadCount},
            </if>
            <if test="fsGroupNoticeDO.hasSend != null and fsGroupNoticeDO.hasSend != ''">
                #{fsGroupNoticeDO.hasSend},
            </if>
            <if test="fsGroupNoticeDO.sendTime != null">
                #{fsGroupNoticeDO.sendTime},
            </if>
            <if test="fsGroupNoticeDO.createUserId != null and fsGroupNoticeDO.createUserId != ''">
                #{fsGroupNoticeDO.createUserId},
            </if>
            <if test="fsGroupNoticeDO.createTime != null">
                #{fsGroupNoticeDO.createTime},
            </if>
            <if test="fsGroupNoticeDO.updateTime != null">
                #{fsGroupNoticeDO.updateTime},
            </if>
            <if test="fsGroupNoticeDO.updateUser != null and fsGroupNoticeDO.updateUser != ''">
                #{fsGroupNoticeDO.updateUser},
            </if>
        </trim>
    </insert>

    <insert id="insertBatch" keyProperty="dos.id" useGeneratedKeys="true">
        insert into fs_group_notice_${eid}(name, img, img_url, content, detail, detail_type, detail_url, send_store_region_ids, send_region_chat_ids, send_other_chat_ids, send_time_type, send_user_count, has_read_count, has_send, send_time, create_user_id, create_time, update_time, update_user)
        values
        <foreach collection="dos" item="do" separator=",">
        (#{do.name}, #{do.img}, #{do.imgUrl}, #{do.content}, #{do.detail}, #{do.detailType}, #{do.detailUrl}, #{do.sendStoreRegionIds}, #{do.sendRegionChatIds}, #{do.sendOtherChatIds}, #{do.sendTimeType}, #{do.sendUserCount}, #{do.hasReadCount}, #{do.hasSend}, #{do.sendTime}, #{do.createUserId}, #{do.createTime}, #{do.updateTime}, #{do.updateUser})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="dos.id" useGeneratedKeys="true">
        insert into fs_group_notice_${eid}(name, img, img_url, content, detail, detail_type, detail_url, send_store_region_ids, send_region_chat_ids, send_other_chat_ids, send_time_type, send_user_count, has_read_count, has_send, send_time, create_user_id, create_time, update_time, update_user)
        values
        <foreach collection="dos" item="do" separator=",">
            (#{do.name}, #{do.img}, #{do.imgUrl}, #{do.content}, #{do.detail}, #{do.detailType}, #{do.detailUrl}, #{do.sendStoreRegionIds}, #{do.sendRegionChatIds}, #{do.sendOtherChatIds}, #{do.sendTimeType}, #{do.sendUserCount}, #{do.hasReadCount}, #{do.hasSend}, #{do.sendTime}, #{do.createUserId}, #{do.createTime}, #{do.updateTime}, #{do.updateUser})
        </foreach>
        on duplicate key update
        name = values(name),
        img = values(img),
        img_url = values(img_url),
        content = values(content),
        detail = values(detail),
        detail_type = values(detail_type),
        detail_url = values(detail_url),
        send_store_region_ids = values(send_store_region_ids),
        send_region_chat_ids = values(send_region_chat_ids),
        send_other_chat_ids = values(send_other_chat_ids),
        send_time_type = values(send_time_type),
        send_user_count = values(send_user_count),
        has_read_count = values(has_read_count),
        has_send = values(has_send),
        send_time = values(send_time),
        create_user_id = values(create_user_id),
        create_time = values(create_time),
        update_time = values(update_time),
        update_user = values(update_user)
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update fs_group_notice_${eid}
        <set>
            <if test="fsGroupNoticeDO.name != null and fsGroupNoticeDO.name != ''">
                name = #{fsGroupNoticeDO.name},
            </if>
            <if test="fsGroupNoticeDO.img != null and fsGroupNoticeDO.img != ''">
                img = #{fsGroupNoticeDO.img},
            </if>
            <if test="fsGroupNoticeDO.imgUrl != null and fsGroupNoticeDO.imgUrl != ''">
                img_url = #{fsGroupNoticeDO.imgUrl},
            </if>
            <if test="fsGroupNoticeDO.content != null and fsGroupNoticeDO.content != ''">
                content = #{fsGroupNoticeDO.content},
            </if>
            <if test="fsGroupNoticeDO.detail != null and fsGroupNoticeDO.detail != ''">
                detail = #{fsGroupNoticeDO.detail},
            </if>
            <if test="fsGroupNoticeDO.detailType != null and fsGroupNoticeDO.detailType != ''">
                detail_type = #{fsGroupNoticeDO.detailType},
            </if>
            <if test="fsGroupNoticeDO.detailUrl != null and fsGroupNoticeDO.detailUrl != ''">
                detail_url = #{fsGroupNoticeDO.detailUrl},
            </if>
            <if test="fsGroupNoticeDO.sendStoreRegionIds != null and fsGroupNoticeDO.sendStoreRegionIds != ''">
                send_store_region_ids = #{fsGroupNoticeDO.sendStoreRegionIds},
            </if>
            <if test="fsGroupNoticeDO.sendRegionChatIds != null and fsGroupNoticeDO.sendRegionChatIds != ''">
                send_region_chat_ids = #{fsGroupNoticeDO.sendRegionChatIds},
            </if>
            <if test="fsGroupNoticeDO.sendOtherChatIds != null and fsGroupNoticeDO.sendOtherChatIds != ''">
                send_other_chat_ids = #{fsGroupNoticeDO.sendOtherChatIds},
            </if>
            <if test="fsGroupNoticeDO.sendTimeType != null and fsGroupNoticeDO.sendTimeType != ''">
                send_time_type = #{fsGroupNoticeDO.sendTimeType},
            </if>
            <if test="fsGroupNoticeDO.sendUserCount != null">
                send_user_count = #{fsGroupNoticeDO.sendUserCount},
            </if>
            <if test="fsGroupNoticeDO.hasReadCount != null">
                has_read_count = #{fsGroupNoticeDO.hasReadCount},
            </if>
            <if test="fsGroupNoticeDO.hasSend != null and fsGroupNoticeDO.hasSend != ''">
                has_send = #{fsGroupNoticeDO.hasSend},
            </if>
            <if test="fsGroupNoticeDO.sendTime != null">
                send_time = #{fsGroupNoticeDO.sendTime},
            </if>
            <if test="fsGroupNoticeDO.createUserId != null and fsGroupNoticeDO.createUserId != ''">
                create_user_id = #{fsGroupNoticeDO.createUserId},
            </if>
            <if test="fsGroupNoticeDO.createTime != null">
                create_time = #{fsGroupNoticeDO.createTime},
            </if>
            <if test="fsGroupNoticeDO.updateTime != null">
                update_time = #{fsGroupNoticeDO.updateTime},
            </if>
            <if test="fsGroupNoticeDO.updateUser != null and fsGroupNoticeDO.updateUser != ''">
                update_user = #{fsGroupNoticeDO.updateUser},
            </if>
        </set>
        where id = #{fsGroupNoticeDO.id}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete from fs_group_notice_${eid} where id = #{id}
    </delete>

    <select id="getFsGroupNoticeList"
            resultType="com.coolcollege.intelligent.model.fsGroup.vo.FsGroupNoticeVO">
        select <include refid="baseSql"></include>,nm.groupCount as groupCount
        from fs_group_notice_${eid} n
        left join  (SELECT notice_id,count(*)as groupCount from fs_group_notice_mapping_${eid}  GROUP BY notice_id)nm
        on n.id = nm.notice_id
        <where>
            <if test="query.name!=null and query.name!=''">
                and n.name like concat('%',#{query.name},'%')
            </if>
            <if test="query.hasSend!=null and query.hasSend!=''">
                and n.has_send = #{query.hasSend}
            </if>
        </where>
        order by create_time desc
    </select>

    <select id="queryTimedNotice" resultType="com.coolcollege.intelligent.model.fsGroup.FsGroupNoticeDO">
        select <include refid="baseSql"></include>
        from fs_group_notice_${eid}
        where send_time_type = '2' and has_send = '0' and send_time between #{beginTime} and #{endTime}
    </select>

</mapper>

